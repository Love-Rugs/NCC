---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import siteSettings from "../content/siteSettings/site.json";

const teams = (await getCollection("teams")).sort((a, b) => a.data.yearGroup.localeCompare(b.data.yearGroup));
const news = (await getCollection("news"))
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 3);
const highlights = (await getCollection("socialHighlights"))
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 3);
---

<BaseLayout title="North Calder Colts | Football Club" description={siteSettings.tagline}>
  <section class="hero">
    <div class="inner">
      <div>
        <h1>North Calder Colts Football Club</h1>
        <p>{siteSettings.tagline}</p>
        <div class="actions">
          <a class="button primary" href={siteSettings.heroCtaHref}>{siteSettings.heroCtaLabel}</a>
          <a class="button secondary" href="/calendar">View Calendar</a>
        </div>
      </div>
      <div class="card">
        <h3>Current Year Groups</h3>
        <ul class="inline-list">
          {teams.map((team) => <li><a href={`/teams/${team.slug}`}>{team.data.yearGroup}</a></li>)}
        </ul>
        <p class="muted">Training updates and parent information for each squad.</p>
      </div>
    </div>
  </section>

  <section class="section">
    <h2>Team Updates</h2>
    <p class="lead">Find the right squad by birth year and check current joining status.</p>
    <div class="grid two">
      {
        teams.map((team) => (
          <article class="card">
            <span class={`badge ${team.data.status}`}>{team.data.status}</span>
            <h3>{team.data.title}</h3>
            <p>{team.data.intro}</p>
            <p class="muted">
              {team.data.trainingDay} | {team.data.trainingTime}
            </p>
            <a href={`/teams/${team.slug}`}>View {team.data.yearGroup} details</a>
          </article>
        ))
      }
    </div>
  </section>

  <section class="section">
    <h2>Latest News</h2>
    <div class="grid three">
      {
        news.map((item) => (
          <article class="card">
            <p class="muted">{item.data.publishDate.toLocaleDateString("en-GB")}</p>
            <h3>{item.data.title}</h3>
            <p>{item.data.summary}</p>
            <a href={`/news/${item.slug}`}>Read update</a>
          </article>
        ))
      }
    </div>
  </section>

  <section class="section">
    <h2>Social Highlights</h2>
    <p class="lead">Manual highlights from Instagram and Facebook to keep the site fast and reliable.</p>
    <div class="grid three">
      {
        highlights.map((item) => (
          <article class="card">
            <span class="badge">{item.data.platform}</span>
            <h3>{item.data.title}</h3>
            <p class="muted">{item.data.publishDate.toLocaleDateString("en-GB")}</p>
            <a href={item.data.postUrl} target="_blank" rel="noreferrer">Open post</a>
          </article>
        ))
      }
    </div>
  </section>
</BaseLayout>
